---
source: src/parser/parser_snap_tests.rs
expression: "format!(\"{:#?}\", t.unwrap())"
---
Module(
    [
        UseDef(
            UseDef(
                [
                    Ident(
                        "exec",
                        None,
                    ),
                ],
                Ident(
                    "host",
                    None,
                ),
            ),
        ),
        EffectDef(
            EffectDef(
                Ident(
                    "Make",
                    None,
                ),
                [
                    Ident(
                        "async",
                        None,
                    ),
                    Ident(
                        "throws",
                        None,
                    ),
                    Ident(
                        "execs",
                        None,
                    ),
                    Ident(
                        "reads",
                        None,
                    ),
                    Ident(
                        "writes",
                        None,
                    ),
                ],
                Block(
                    [
                        Prototype {
                            name: Ident(
                                "catch",
                                None,
                            ),
                            args: [],
                            ret: None,
                            effects: [
                                Ident(
                                    "throws",
                                    None,
                                ),
                            ],
                        },
                        Prototype {
                            name: Ident(
                                "await",
                                Some(
                                    [
                                        Ident(
                                            "T",
                                            None,
                                        ),
                                    ],
                                ),
                            ),
                            args: [
                                Field(
                                    Field(
                                        Ident(
                                            "f",
                                            None,
                                        ),
                                        Ident(
                                            "Future",
                                            Some(
                                                [
                                                    Ident(
                                                        "T",
                                                        None,
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ),
                                ),
                            ],
                            ret: Some(
                                Ident(
                                    "T",
                                    None,
                                ),
                            ),
                            effects: [
                                Ident(
                                    "async",
                                    None,
                                ),
                                Ident(
                                    "throws",
                                    None,
                                ),
                            ],
                        },
                        Prototype {
                            name: Ident(
                                "exec",
                                None,
                            ),
                            args: [
                                Field(
                                    Field(
                                        Ident(
                                            "arg0",
                                            None,
                                        ),
                                        Ident(
                                            "string",
                                            None,
                                        ),
                                    ),
                                ),
                                Field(
                                    Field(
                                        Ident(
                                            "args",
                                            None,
                                        ),
                                        Ident(
                                            "stringvec",
                                            None,
                                        ),
                                    ),
                                ),
                            ],
                            ret: Some(
                                Ident(
                                    "i32",
                                    None,
                                ),
                            ),
                            effects: [
                                Ident(
                                    "Make",
                                    None,
                                ),
                            ],
                        },
                        Prototype {
                            name: Ident(
                                "read",
                                None,
                            ),
                            args: [
                                Field(
                                    Field(
                                        Ident(
                                            "name",
                                            None,
                                        ),
                                        Ident(
                                            "string",
                                            None,
                                        ),
                                    ),
                                ),
                            ],
                            ret: Some(
                                Ident(
                                    "string",
                                    None,
                                ),
                            ),
                            effects: [
                                Ident(
                                    "reads",
                                    None,
                                ),
                            ],
                        },
                        Prototype {
                            name: Ident(
                                "write",
                                None,
                            ),
                            args: [
                                Field(
                                    Field(
                                        Ident(
                                            "name",
                                            None,
                                        ),
                                        Ident(
                                            "string",
                                            None,
                                        ),
                                    ),
                                ),
                                Field(
                                    Field(
                                        Ident(
                                            "value",
                                            None,
                                        ),
                                        Ident(
                                            "string",
                                            None,
                                        ),
                                    ),
                                ),
                            ],
                            ret: None,
                            effects: [
                                Ident(
                                    "writes",
                                    None,
                                ),
                            ],
                        },
                    ],
                ),
            ),
        ),
        StructDef(
            StructDef(
                Ident(
                    "Local",
                    None,
                ),
                Block(
                    [
                        Field(
                            Ident(
                                "host",
                                None,
                            ),
                            Ident(
                                "host",
                                None,
                            ),
                        ),
                    ],
                ),
            ),
        ),
        ImplDef(
            ImplDef(
                Ident(
                    "Make",
                    None,
                ),
                Some(
                    Ident(
                        "Local",
                        None,
                    ),
                ),
                Block(
                    [
                        FnDef(
                            FnDef(
                                Prototype {
                                    name: Ident(
                                        "catch",
                                        None,
                                    ),
                                    args: [
                                        Reciever,
                                    ],
                                    ret: None,
                                    effects: [
                                        Ident(
                                            "throws",
                                            None,
                                        ),
                                    ],
                                },
                                Block(
                                    [],
                                ),
                                [],
                            ),
                        ),
                        FnDef(
                            FnDef(
                                Prototype {
                                    name: Ident(
                                        "await",
                                        Some(
                                            [
                                                Ident(
                                                    "T",
                                                    None,
                                                ),
                                            ],
                                        ),
                                    ),
                                    args: [
                                        Field(
                                            Field(
                                                Ident(
                                                    "f",
                                                    None,
                                                ),
                                                Ident(
                                                    "Future",
                                                    Some(
                                                        [
                                                            Ident(
                                                                "T",
                                                                None,
                                                            ),
                                                        ],
                                                    ),
                                                ),
                                            ),
                                        ),
                                    ],
                                    ret: Some(
                                        Ident(
                                            "T",
                                            None,
                                        ),
                                    ),
                                    effects: [
                                        Ident(
                                            "async",
                                            None,
                                        ),
                                        Ident(
                                            "trhows",
                                            None,
                                        ),
                                    ],
                                },
                                Block(
                                    [
                                        FnCall(
                                            FnCall(
                                                Ident(
                                                    "yield",
                                                    None,
                                                ),
                                                [],
                                            ),
                                        ),
                                    ],
                                ),
                                [],
                            ),
                        ),
                        FnDef(
                            FnDef(
                                Prototype {
                                    name: Ident(
                                        "exec",
                                        None,
                                    ),
                                    args: [
                                        Reciever,
                                        Field(
                                            Field(
                                                Ident(
                                                    "arg0",
                                                    None,
                                                ),
                                                Ident(
                                                    "string",
                                                    None,
                                                ),
                                            ),
                                        ),
                                        Field(
                                            Field(
                                                Ident(
                                                    "args",
                                                    None,
                                                ),
                                                Ident(
                                                    "vec",
                                                    Some(
                                                        [
                                                            Ident(
                                                                "string",
                                                                None,
                                                            ),
                                                        ],
                                                    ),
                                                ),
                                            ),
                                        ),
                                    ],
                                    ret: Some(
                                        Ident(
                                            "i32",
                                            None,
                                        ),
                                    ),
                                    effects: [
                                        Ident(
                                            "Vm",
                                            None,
                                        ),
                                    ],
                                },
                                Block(
                                    [
                                        FieldAccess(
                                            FieldAccess(
                                                FieldAccess(
                                                    FieldAccess(
                                                        FieldAccess(
                                                            FieldAccess(
                                                                Ident(
                                                                    Ident(
                                                                        "self",
                                                                        None,
                                                                    ),
                                                                ),
                                                                Ident(
                                                                    Ident(
                                                                        "host",
                                                                        None,
                                                                    ),
                                                                ),
                                                            ),
                                                        ),
                                                        FnCall(
                                                            FnCall(
                                                                Ident(
                                                                    "read",
                                                                    None,
                                                                ),
                                                                [
                                                                    String(
                                                                        "jobserver",
                                                                    ),
                                                                ],
                                                            ),
                                                        ),
                                                    ),
                                                ),
                                                Ident(
                                                    Ident(
                                                        "await",
                                                        None,
                                                    ),
                                                ),
                                            ),
                                        ),
                                        Branch(
                                            Branch(
                                                FieldAccess(
                                                    FieldAccess(
                                                        FieldAccess(
                                                            FieldAccess(
                                                                FieldAccess(
                                                                    FieldAccess(
                                                                        Ident(
                                                                            Ident(
                                                                                "self",
                                                                                None,
                                                                            ),
                                                                        ),
                                                                        Ident(
                                                                            Ident(
                                                                                "host",
                                                                                None,
                                                                            ),
                                                                        ),
                                                                    ),
                                                                ),
                                                                FnCall(
                                                                    FnCall(
                                                                        Ident(
                                                                            "exec",
                                                                            None,
                                                                        ),
                                                                        [
                                                                            Ident(
                                                                                Ident(
                                                                                    "arg0",
                                                                                    None,
                                                                                ),
                                                                            ),
                                                                            Ident(
                                                                                Ident(
                                                                                    "args",
                                                                                    None,
                                                                                ),
                                                                            ),
                                                                        ],
                                                                    ),
                                                                ),
                                                            ),
                                                        ),
                                                        Ident(
                                                            Ident(
                                                                "await",
                                                                None,
                                                            ),
                                                        ),
                                                    ),
                                                ),
                                                [
                                                    (
                                                        Bool(
                                                            true,
                                                        ),
                                                        Block(
                                                            [
                                                                FnCall(
                                                                    FnCall(
                                                                        Ident(
                                                                            "raise",
                                                                            None,
                                                                        ),
                                                                        [
                                                                            Integer(
                                                                                1,
                                                                            ),
                                                                        ],
                                                                    ),
                                                                ),
                                                            ],
                                                        ),
                                                    ),
                                                ],
                                            ),
                                        ),
                                    ],
                                ),
                                [],
                            ),
                        ),
                    ],
                ),
            ),
        ),
    ],
)
